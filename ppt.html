<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prastuti - AI PPT Tool</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.5.2/peerjs.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Playfair+Display:wght@400;600;700&family=Source+Sans+Pro:wght@300;400;600&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg-color:#fff;--text-color:#000;--secondary-text:#666;--border-color:#ccc;--accent-color:#0066cc;--hover-color:#f5f5f5;--button-bg:#000;--button-text:#fff;--logo-font:'Pacifico',cursive;--heading-font:'Playfair Display',serif;--body-font:'Source Sans Pro',sans-serif;--ui-font:'Poppins',sans-serif}
.dark-theme{--bg-color:#000;--text-color:#fff;--secondary-text:#999;--border-color:#333;--accent-color:#4da6ff;--hover-color:#1a1a1a;--button-bg:#fff;--button-text:#000}
body{font-family:var(--body-font);background-color:var(--bg-color);color:var(--text-color);line-height:1.6;transition:all .3s ease;overflow-x:hidden}
.container{max-width:1200px;margin:0 auto;padding:0 20px}
header{padding:20px 0;border-bottom:1px solid var(--border-color)}
.header-content{display:flex;justify-content:space-between;align-items:center}
.logo{font-family:var(--logo-font);font-size:32px;color:var(--accent-color)}
.theme-toggle{background:var(--button-bg);color:var(--button-text);border:none;padding:10px 18px;cursor:pointer;font-size:14px;font-family:var(--ui-font);font-weight:500;border-radius:25px;transition:all .3s;display:flex;align-items:center;gap:8px}
.theme-toggle:hover{opacity:.8;transform:translateY(-1px)}
.main-content{padding:60px 0}
.hero{text-align:center;margin-bottom:60px}
.hero h1{font-family:var(--heading-font);font-size:56px;font-weight:700;margin-bottom:16px}
.hero p{font-family:var(--body-font);font-size:20px;color:var(--secondary-text);margin-bottom:40px}
.greeting-message{font-family:var(--ui-font);font-size:24px;color:var(--accent-color);margin-bottom:20px;font-weight:500}
.action-buttons{display:flex;gap:20px;justify-content:center;flex-wrap:wrap;margin-bottom:40px}
.btn{padding:14px 28px;font-size:16px;font-weight:600;font-family:var(--ui-font);cursor:pointer;transition:all .3s;text-decoration:none;display:inline-flex;align-items:center;gap:10px;border:none;border-radius:8px}
.btn-primary{background:var(--button-bg);color:var(--button-text)}
.btn-secondary{background:transparent;color:var(--text-color);border:2px solid var(--border-color)}
.btn:hover{opacity:.9;transform:translateY(-2px)}
.credit-section{margin-top:60px;text-align:center;opacity:.7}
.credit-link{color:var(--secondary-text);text-decoration:none;font-size:12px;font-family:var(--ui-font);display:inline-flex;align-items:center;gap:6px}
.credit-link:hover{color:var(--accent-color)}
.credit-link i{color:#e91e63;font-size:14px}
.input-section{max-width:600px;margin:0 auto;display:none}
.form-group{margin-bottom:24px}
.form-group label{display:block;margin-bottom:8px;font-weight:600;font-family:var(--ui-font);font-size:14px;text-transform:uppercase;letter-spacing:.5px}
.form-group input,.form-group textarea,.form-group select{width:100%;padding:14px;border:2px solid var(--border-color);background:var(--bg-color);color:var(--text-color);font-size:16px;font-family:var(--body-font);border-radius:8px}
.form-group textarea{min-height:200px;resize:vertical}
.template-display{background:var(--hover-color);padding:24px;margin:20px 0;border:2px solid var(--border-color);border-radius:12px;font-family:monospace;font-size:13px;white-space:pre-wrap;word-wrap:break-word;line-height:1.5}
.copy-btn{background:var(--accent-color);color:#fff;border:none;padding:10px 20px;cursor:pointer;font-size:14px;font-family:var(--ui-font);font-weight:500;border-radius:6px;margin-top:12px;display:inline-flex;align-items:center;gap:8px}
.presentation-view{display:none;position:relative;height:100vh;background:var(--bg-color)}
.presentation-view header{display:none!important}
.slide{display:none;padding:60px;height:100vh;overflow-y:auto}
.slide.active{display:block}
.slide h1{font-family:var(--heading-font);font-size:48px;margin-bottom:30px;text-align:center;font-weight:700}
.slide h2{font-family:var(--heading-font);font-size:36px;margin-bottom:24px;font-weight:600}
.slide h3{font-family:var(--heading-font);font-size:28px;margin-bottom:20px;font-weight:500}
.slide p{font-family:var(--body-font);font-size:20px;margin-bottom:16px;line-height:1.7}
.slide ul,.slide ol{margin-left:40px;margin-bottom:20px}
.slide li{font-family:var(--body-font);font-size:18px;margin-bottom:8px;line-height:1.6}
.slide table{width:100%;border-collapse:collapse;margin:20px 0;font-family:var(--body-font);font-size:18px}
.slide th,.slide td{border:1px solid var(--border-color);padding:16px;text-align:left;font-size:18px}
.slide th{background:var(--hover-color);font-weight:600;font-family:var(--ui-font);font-size:18px}
.controls{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);display:flex;gap:12px;background:rgba(0,0,0,.9);padding:12px 24px;border-radius:50px;opacity:0;transition:opacity .3s;z-index:1000}
.controls.visible{opacity:1}
.control-btn{background:transparent;color:#fff;border:none;padding:10px 14px;cursor:pointer;font-size:14px;font-family:var(--ui-font);font-weight:500;border-radius:25px;transition:all .3s;display:flex;align-items:center;gap:6px}
.control-btn:hover{background:rgba(255,255,255,.2)}
.progress-bar{position:fixed;top:0;left:0;height:4px;background:linear-gradient(90deg,var(--accent-color),#4da6ff);transition:width .3s;z-index:1000}
.end-options{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--bg-color);border:2px solid var(--border-color);padding:40px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.3);border-radius:16px;z-index:1001}
.end-options h2{font-family:var(--heading-font);font-size:28px;margin-bottom:16px}
.end-options p{font-family:var(--body-font);font-size:16px;color:var(--secondary-text)}
.highlight{background:#ffeb3b;color:#000;padding:2px 6px;border-radius:4px;font-weight:500}
.important{color:#f44336;font-weight:700}
.success{color:#4caf50;font-weight:700}
.info{color:#2196f3;font-weight:700}
.copy-success-modal,.nav-instructions-modal,.projects-modal,.api-modal,.remote-setup-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);z-index:2000}
.modal-content{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--bg-color);padding:30px;border-radius:12px;text-align:center;max-width:500px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,.3)}
.modal-content h3{font-family:var(--heading-font);font-size:24px;margin-bottom:16px;color:var(--accent-color)}
.modal-content p{font-family:var(--body-font);margin-bottom:12px;line-height:1.6}
.close-btn{background:var(--accent-color);color:#fff;border:none;padding:12px 24px;cursor:pointer;font-size:14px;font-family:var(--ui-font);font-weight:500;border-radius:6px;margin-top:20px}
.nav-instructions-list{text-align:left;margin:20px 0}
.nav-instructions-list li{font-family:var(--body-font);margin-bottom:12px;font-size:16px;display:flex;align-items:center;gap:12px}
.nav-instructions-list i{color:var(--accent-color);font-size:18px;width:20px}
.project-list{max-height:400px;overflow-y:auto;margin:20px 0}
.project-item{background:var(--hover-color);padding:15px;margin-bottom:10px;border-radius:8px;border:1px solid var(--border-color);text-align:left}
.project-name{font-weight:bold;margin-bottom:5px;color:var(--accent-color)}
.project-preview{color:var(--secondary-text);font-size:.85rem;margin-bottom:8px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.project-stats{color:var(--secondary-text);font-size:.75rem;margin-bottom:10px}
.project-actions{display:flex;gap:8px}
.project-actions button{padding:6px 12px;border:1px solid var(--border-color);background:transparent;color:var(--text-color);border-radius:4px;font-size:.75rem;cursor:pointer}
.code-input{background:var(--hover-color);border:1px solid var(--border-color);color:var(--text-color);padding:15px;font-size:1.5rem;text-align:center;border-radius:8px;letter-spacing:5px;outline:none;width:100%;margin-bottom:15px}
.status{margin-top:10px;color:var(--secondary-text);font-size:.9rem;text-align:center}
.status.error{color:#f44336}
#controllerView{display:none;flex-direction:column;height:100vh;background:var(--bg-color)}
.controller-header{padding:15px;background:var(--hover-color);display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border-color)}
.controller-header h2{font-family:var(--heading-font);font-size:20px}
.disconnect-btn{background:#f44336;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:14px}
.controller-content{flex:1;overflow-y:auto;padding:20px}
.control-section{margin-bottom:30px}
.control-section h3{font-family:var(--heading-font);font-size:18px;margin-bottom:15px;color:var(--accent-color)}
.control-row{display:flex;gap:10px;margin-bottom:10px;flex-wrap:wrap}
.control-row button{flex:1;min-width:100px;padding:12px;background:var(--button-bg);color:var(--button-text);border:none;border-radius:6px;cursor:pointer;font-size:14px;font-family:var(--ui-font)}
.control-row button:hover{opacity:.9}
.slider-control{margin-bottom:15px}
.slider-control label{display:block;margin-bottom:8px;font-size:14px;font-weight:500}
.slider-control input{width:100%;height:6px;border-radius:3px;outline:none;background:var(--border-color)}
.slider-value{float:right;color:var(--accent-color);font-weight:600}
@media(max-width:768px){
.hero h1{font-size:42px}
.slide{padding:30px 20px}
.slide h1{font-size:36px}
.logo{font-size:28px}
.controls{padding:8px 16px;gap:8px;max-width:90%;flex-wrap:wrap}
.control-btn{padding:8px 12px;font-size:12px}
}
</style>
</head>
<body>
<header id="mainHeader">
<div class="container">
<div class="header-content">
<div class="logo">Prastuti</div>
<button class="theme-toggle" onclick="toggleTheme()">
<i class="fas fa-moon"></i>
Theme
</button>
</div>
</div>
</header>

<main class="main-content" id="mainContent">
<div class="container">
<div class="hero" id="heroSection">
<div id="greetingMessage" class="greeting-message" style="display:none;"></div>
<h1>AI-Powered Presentation Generator</h1>
<p>A Completely Free AI PPT Making Tool</p>
<div class="action-buttons">
<button class="btn btn-primary" onclick="showCreateNew()">
<i class="fas fa-plus-circle"></i>
Create New PPT
</button>
<button class="btn btn-secondary" onclick="showRemoteSetup()">
<i class="fas fa-wifi"></i>
Connect Remote
</button>
<button class="btn btn-secondary" onclick="openProjectsModal()">
<i class="fas fa-folder"></i>
Saved Projects
</button>
</div>
<div class="credit-section">
<a href="https://www.google.com/search?q=chinurag" target="_blank" class="credit-link">
<i class="fas fa-heart"></i>
View more from Chinurag
</a>
</div>
</div>

<div class="input-section" id="inputSection">
<div class="form-group">
<label for="topicName">
<i class="fas fa-lightbulb"></i>
Presentation Topic:
</label>
<input type="text" id="topicName" placeholder="Enter your presentation topic">
</div>
<div class="form-group">
<label for="authorName">
<i class="fas fa-user"></i>
Your Name (Optional):
</label>
<input type="text" id="authorName" placeholder="Enter your name">
</div>
<div class="form-group">
<label for="generationMethod">
<i class="fas fa-cog"></i>
Generation Method:
</label>
<select id="generationMethod">
<option value="template">Manual (Copy Template)</option>
<option value="ai">AI Generate (Gemini API)</option>
</select>
</div>
<div id="apiKeySection" style="display:none;">
<div class="form-group">
<label for="apiKey">
<i class="fas fa-key"></i>
Gemini API Key:
</label>
<input type="text" id="apiKey" placeholder="Enter your Gemini API key">
</div>
</div>
<button class="btn btn-primary" onclick="generateContent()">
<i class="fas fa-magic"></i>
Generate Presentation
</button>

<div id="templateSection" style="display:none;">
<h3 style="font-family:var(--heading-font);font-size:24px;margin:30px 0 20px 0;">Copy this template and paste it to your AI tool:</h3>
<div class="template-display" id="templateDisplay"></div>
<button class="copy-btn" onclick="copyTemplate()">
<i class="fas fa-copy"></i>
Copy Template
</button>
<div class="form-group" style="margin-top:30px;">
<label for="xmlInput">
<i class="fas fa-code"></i>
Paste the AI-generated XML here:
</label>
<textarea id="xmlInput" placeholder="Paste your AI-generated XML presentation here..."></textarea>
</div>
<button class="btn btn-primary" onclick="createPresentation()">
<i class="fas fa-play"></i>
Create Presentation
</button>
</div>
</div>
</div>
</main>

<div class="presentation-view" id="presentationView">
<div class="progress-bar" id="progressBar"></div>
<div id="slidesContainer"></div>
<div class="controls" id="controls">
<button class="control-btn" onclick="previousSlide()">
<i class="fas fa-chevron-left"></i>
Previous
</button>
<button class="control-btn" onclick="nextSlide()">
Next
<i class="fas fa-chevron-right"></i>
</button>
<button class="control-btn" onclick="toggleFullscreen()">
<i class="fas fa-expand"></i>
Fullscreen
</button>
<button class="control-btn" onclick="toggleTheme()">
<i class="fas fa-moon"></i>
Theme
</button>
<button class="control-btn" onclick="exitPresentation()">
<i class="fas fa-times"></i>
Exit
</button>
</div>
</div>

<div id="controllerView">
<div class="controller-header">
<h2>Remote Control</h2>
<button class="disconnect-btn" onclick="disconnectRemote()">Disconnect</button>
</div>
<div class="controller-content">
<div class="control-section">
<h3>Navigation</h3>
<div class="control-row">
<button onclick="remoteAction('prev')"><i class="fas fa-chevron-left"></i> Previous</button>
<button onclick="remoteAction('next')"><i class="fas fa-chevron-right"></i> Next</button>
</div>
<div class="control-row">
<button onclick="remoteAction('reset')"><i class="fas fa-redo"></i> Reset</button>
<button onclick="remoteAction('fullscreen')"><i class="fas fa-expand"></i> Fullscreen</button>
</div>
</div>
<div class="control-section">
<h3>Appearance</h3>
<div class="control-row">
<button onclick="remoteAction('theme')"><i class="fas fa-moon"></i> Toggle Theme</button>
</div>
<div class="slider-control">
<label>Font Size <span class="slider-value" id="fontSizeValue">20px</span></label>
<input type="range" id="fontSizeSlider" min="14" max="48" value="20" oninput="updateRemoteFontSize(this.value)">
</div>
</div>
<div class="control-section">
<h3>Actions</h3>
<div class="control-row">
<button onclick="openProjectsModal()"><i class="fas fa-folder"></i> Projects</button>
<button onclick="remoteAction('exit')"><i class="fas fa-times"></i> Exit</button>
</div>
</div>
</div>
</div>

<div class="end-options" id="endOptions">
<h2>Presentation Complete!</h2>
<p style="margin:20px 0;">What would you like to do next?</p>
<div style="display:flex;gap:15px;justify-content:center;flex-wrap:wrap;">
<button class="btn btn-primary" onclick="restartPresentation()">
<i class="fas fa-redo"></i>
Restart
</button>
<button class="btn btn-secondary" onclick="downloadPresentation()">
<i class="fas fa-save"></i>
Download
</button>
<button class="btn btn-secondary" onclick="sharePresentation()">
<i class="fas fa-share"></i>
Share
</button>
<button class="btn btn-secondary" onclick="createNewPresentation()">
<i class="fas fa-plus"></i>
Create New
</button>
</div>
</div>

<div class="copy-success-modal" id="copySuccessModal">
<div class="modal-content">
<h3><i class="fas fa-check-circle"></i> Code Copied!</h3>
<p><strong>Next Steps:</strong></p>
<p>1. Open your preferred AI tool (ChatGPT, Claude, Gemini, etc.)</p>
<p>2. Paste the copied template and press Enter</p>
<p>3. Copy the AI-generated XML response</p>
<p>4. Come back here and paste it in the XML input field</p>
<p>5. Click "Create Presentation" to start your slideshow</p>
<button class="close-btn" onclick="closeModal('copySuccessModal')">
<i class="fas fa-times"></i>
Close
</button>
</div>
</div>

<div class="nav-instructions-modal" id="navInstructionsModal">
<div class="modal-content">
<h3><i class="fas fa-info-circle"></i> Navigation Guide</h3>
<p>Here's how to navigate through your presentation:</p>
<ul class="nav-instructions-list">
<li><i class="fas fa-hand-pointer"></i>Double tap anywhere on screen to show/hide controls</li>
<li><i class="fas fa-swatchbook"></i>Swipe left or right to navigate between slides</li>
<li><i class="fas fa-keyboard"></i>Use arrow keys or spacebar (desktop)</li>
<li><i class="fas fa-expand"></i>Use fullscreen mode for better experience</li>
<li><i class="fas fa-moon"></i>Toggle dark/light theme anytime</li>
</ul>
<button class="close-btn" onclick="closeModal('navInstructionsModal')">
<i class="fas fa-play"></i>
Got it, Start Presentation
</button>
</div>
</div>

<div class="projects-modal" id="projectsModal">
<div class="modal-content" style="max-width:700px;">
<h3><i class="fas fa-folder"></i> Saved Projects</h3>
<div class="project-list" id="projectList"></div>
<button class="close-btn" onclick="closeModal('projectsModal')">
<i class="fas fa-times"></i>
Close
</button>
</div>
</div>

<div class="remote-setup-modal" id="remoteSetupModal">
<div class="modal-content">
<h3><i class="fas fa-wifi"></i> Remote Control Setup</h3>
<div style="margin:20px 0;">
<button class="btn btn-primary" style="width:100%;margin-bottom:15px;" onclick="startDisplay()">
<i class="fas fa-tv"></i>
I AM THE DISPLAY
</button>
<button class="btn btn-secondary" style="width:100%;" onclick="showRemoteConnect()">
<i class="fas fa-mobile-alt"></i>
I AM THE REMOTE
</button>
</div>
<div id="remoteConnectSection" style="display:none;">
<input type="number" id="roomCodeInput" class="code-input" placeholder="0000" pattern="\d*">
<button class="btn btn-primary" style="width:100%;" onclick="connectToDisplay()">
<i class="fas fa-link"></i>
CONNECT
</button>
</div>
<div class="status" id="remoteStatus">Select your device role</div>
<button class="close-btn" onclick="closeModal('remoteSetupModal')">
<i class="fas fa-times"></i>
Close
</button>
</div>
</div>

<script>
const ID_PREFIX="PRASTUTI-";
let peer,conn,mode='',myRoomCode='',heartbeatInterval;
let currentSlide=0,slides=[],presentationData=null;
let touchStartX=0,touchEndX=0,lastTap=0;
const STATE_KEYS={USER_NAME:'prastuti_user_name',CURRENT_STATE:'prastuti_current_state',PRESENTATION_DATA:'prastuti_presentation_data',CURRENT_SLIDE:'prastuti_current_slide',TOPIC:'prastuti_topic',AUTHOR:'prastuti_author',XML_INPUT:'prastuti_xml_input',TEMPLATE_VISIBLE:'prastuti_template_visible',THEME:'prastuti_theme',SEEN_INSTRUCTIONS:'prastuti_seen_instructions',API_KEY:'prastuti_api_key',PROJECTS:'prastuti_projects'};
const APP_STATES={HOME:'home',CREATE_NEW:'create_new',TEMPLATE_GENERATED:'template_generated',PRESENTATION:'presentation',REMOTE_DISPLAY:'remote_display',REMOTE_CONTROLLER:'remote_controller'};

document.getElementById('generationMethod').addEventListener('change',function(){
document.getElementById('apiKeySection').style.display=this.value==='ai'?'block':'none';
});

function loadState(){
const savedState=localStorage.getItem(STATE_KEYS.CURRENT_STATE);
const savedName=localStorage.getItem(STATE_KEYS.USER_NAME);
const savedApiKey=localStorage.getItem(STATE_KEYS.API_KEY);
if(savedName){
document.getElementById('authorName').value=savedName;
showGreeting(savedName);
}
if(savedApiKey)document.getElementById('apiKey').value=savedApiKey;
}

function saveState(state){
localStorage.setItem(STATE_KEYS.CURRENT_STATE,state);
}

function showGreeting(name){
const greetingElement=document.getElementById('greetingMessage');
const greetings=[`Welcome back, ${name}! ðŸ‘‹`,`Hello ${name}! Ready to create? âœ¨`,`Good to see you again, ${name}! ðŸŽ‰`,`Hey ${name}! Let's make something amazing! ðŸš€`];
const randomGreeting=greetings[Math.floor(Math.random()*greetings.length)];
greetingElement.textContent=randomGreeting;
greetingElement.style.display='block';
}

function toggleTheme(){
document.body.classList.toggle('dark-theme');
localStorage.setItem(STATE_KEYS.THEME,document.body.classList.contains('dark-theme')?'dark':'light');
const themeIcons=document.querySelectorAll('.theme-toggle i');
themeIcons.forEach(icon=>{
if(document.body.classList.contains('dark-theme')){
icon.className='fas fa-sun';
}else{
icon.className='fas fa-moon';
}
});
if(conn&&conn.open)sendRemoteData({type:'theme'});
}

function loadTheme(){
const savedTheme=localStorage.getItem(STATE_KEYS.THEME);
if(savedTheme==='dark'){
document.body.classList.add('dark-theme');
document.querySelectorAll('.theme-toggle i').forEach(icon=>{
icon.className='fas fa-sun';
});
}
}

function showCreateNew(){
document.getElementById('inputSection').style.display='block';
document.getElementById('heroSection').style.display='none';
saveState(APP_STATES.CREATE_NEW);
}

function closeModal(modalId){
document.getElementById(modalId).style.display='none';
if(modalId==='navInstructionsModal')localStorage.setItem(STATE_KEYS.SEEN_INSTRUCTIONS,'true');
}

async function generateContent(){
const topic=document.getElementById('topicName').value.trim();
const author=document.getElementById('authorName').value.trim();
const method=document.getElementById('generationMethod').value;
if(!topic){
alert('Please enter a presentation topic');
return;
}
localStorage.setItem(STATE_KEYS.TOPIC,topic);
localStorage.setItem(STATE_KEYS.AUTHOR,author);
if(author)localStorage.setItem(STATE_KEYS.USER_NAME,author);
if(method==='ai'){
const apiKey=document.getElementById('apiKey').value.trim();
if(!apiKey){
alert('Please enter your Gemini API key');
return;
}
localStorage.setItem(STATE_KEYS.API_KEY,apiKey);
await generateAiPresentation(topic,author,apiKey);
}else{
generateTemplateContent(topic,author);
document.getElementById('templateSection').style.display='block';
localStorage.setItem(STATE_KEYS.TEMPLATE_VISIBLE,'true');
saveState(APP_STATES.TEMPLATE_GENERATED);
}
}

async function generateAiPresentation(topic,author,apiKey){
const btn=event.target;
btn.disabled=true;
btn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Generating...';
try{
const prompt=`Create a comprehensive presentation on "${topic}" in XML format. Follow this exact structure:

<?xml version="1.0" encoding="UTF-8"?>
<presentation>
<topic>${topic}</topic>
<author>${author||'Anonymous'}</author>
<slide>
<h1>${topic}</h1>
<p>By ${author||'Anonymous'}</p>
</slide>

Create 8-12 slides with:
- Use <h1>, <h2>, <h3> for headings
- Use <p> for paragraphs
- Use <ul><li></li></ul> for bullet points
- Use <ol><li></li></ol> for numbered lists
- Use <table><tr><th></th></tr><tr><td></td></tr></table> for tables
- Use <span class="highlight">text</span> for highlights
- Use <span class="important">text</span> for important text
- Use <span class="success">text</span> for success text
- Use <span class="info">text</span> for info text
- Make 2 MCQ slides at the end
- Use professional, engaging content

Wrap each slide in <slide></slide> tags. Use proper XML escaping (&amp; for &, &lt; for <, &gt; for >).`;

const res=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`,{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})
});
const data=await res.json();
if(data.candidates&&data.candidates[0]){
let xmlContent=data.candidates[0].content.parts[0].text;
xmlContent=xmlContent.replace(/```xml\n?/g,'').replace(/```\n?/g,'').trim();
if(!xmlContent.startsWith('<?xml')){
xmlContent='<?xml version="1.0" encoding="UTF-8"?>\n'+xmlContent;
}
document.getElementById('xmlInput').value=xmlContent;
localStorage.setItem(STATE_KEYS.XML_INPUT,xmlContent);
document.getElementById('templateSection').style.display='block';
btn.innerHTML='<i class="fas fa-check"></i> Generated! Create Presentation Below';
setTimeout(()=>{
btn.innerHTML='<i class="fas fa-magic"></i> Generate Presentation';
btn.disabled=false;
},3000);
}else{
throw new Error('Failed to generate content');
}
}catch(err){
alert('Error generating presentation: '+err.message);
btn.innerHTML='<i class="fas fa-magic"></i> Generate Presentation';
btn.disabled=false;
}
}

function generateTemplateContent(topic,author){
const template=`Create a comprehensive presentation on "${topic}" in XML format. Follow this exact structure and guidelines:

**IMPORTANT XML STRUCTURE REQUIREMENTS:**
- Start with <?xml version="1.0" encoding="UTF-8"?>
- Use <presentation> as root element
- Include <topic>${topic}</topic>
- Include <author>${author||'Anonymous'}</author>
- Each slide must be wrapped in <slide> tags
- Create as many slides as needed (no limit)

**FORMATTING FEATURES AVAILABLE:**
- Headings: <h1>, <h2>, <h3>
- Paragraphs: <p>
- Bullet points: <ul><li></li></ul>
- Numbered lists: <ol><li></li></ol>
- Tables: <table><tr><th></th></tr><tr><td></td></tr></table>
- Text highlighting: <span class="highlight">important text</span>
- Important text: <span class="important">critical info</span>
- Success text: <span class="success">positive info</span>
- Info text: <span class="info">additional info</span>

**CONTENT GUIDELINES:**
- Create a title slide with topic and author
- Include introduction, main content slides, and conclusion
- Use bullet points and lists effectively
- Add tables when data presentation is helpful
- Highlight key information using color classes
- Make content engaging and well-structured
- Use professional language appropriate for presentations
- Make 2 MCQ slides in end one for question from the ppt and other explaining the correct answer

**SPECIAL CHARACTERS:**
- Use &amp; for &
- Use &lt; for <
- Use &gt; for >
- Use &quot; for "
- Use &#39; for '

**EXAMPLE SLIDE STRUCTURE:**
<slide>
<h1>Slide Title</h1>
<p>Introduction paragraph</p>
<ul>
<li>Bullet point 1</li>
<li><span class="important">Important bullet point</span></li>
<li>Bullet point 3</li>
</ul>
<table>
<tr><th>Header 1</th><th>Header 2</th></tr>
<tr><td>Data 1</td><td>Data 2</td></tr>
</table>
</slide>

Please create a complete, professional presentation following these guidelines.`;
document.getElementById('templateDisplay').textContent=template;
}

function copyTemplate(){
const template=document.getElementById('templateDisplay').textContent;
navigator.clipboard.writeText(template).then(()=>{
document.getElementById('copySuccessModal').style.display='block';
});
}

function createPresentation(){
const xmlContent=document.getElementById('xmlInput').value.trim();
if(!xmlContent){
alert('Please paste the AI-generated XML content');
return;
}
try{
const parser=new DOMParser();
const xmlDoc=parser.parseFromString(xmlContent,'text/xml');
const parserError=xmlDoc.querySelector('parsererror');
if(parserError)throw new Error('Invalid XML format');
const slideElements=xmlDoc.querySelectorAll('slide');
if(slideElements.length===0)throw new Error('No slides found in XML');
const topicElement=xmlDoc.querySelector('topic');
const authorElement=xmlDoc.querySelector('author');
if(topicElement)localStorage.setItem(STATE_KEYS.TOPIC,topicElement.textContent);
if(authorElement){
localStorage.setItem(STATE_KEYS.AUTHOR,authorElement.textContent);
localStorage.setItem(STATE_KEYS.USER_NAME,authorElement.textContent);
}
slides=Array.from(slideElements).map(slide=>slide.innerHTML);
presentationData=xmlContent;
localStorage.setItem(STATE_KEYS.PRESENTATION_DATA,xmlContent);
localStorage.setItem(STATE_KEYS.CURRENT_SLIDE,'0');
saveProject(xmlContent);
startPresentation();
}catch(error){
alert('Error parsing XML: '+error.message+'\n\nPlease check your XML format and try again.');
}
}

function saveProject(xmlContent){
const projects=JSON.parse(localStorage.getItem(STATE_KEYS.PROJECTS)||'[]');
const topic=localStorage.getItem(STATE_KEYS.TOPIC)||'Untitled';
const author=localStorage.getItem(STATE_KEYS.AUTHOR)||'Anonymous';
const existing=projects.findIndex(p=>p.topic===topic);
const project={
topic:topic,
author:author,
xml:xmlContent,
date:new Date().toISOString(),
slides:slides.length
};
if(existing>=0){
projects[existing]=project;
}else{
projects.push(project);
}
localStorage.setItem(STATE_KEYS.PROJECTS,JSON.stringify(projects));
}

function openProjectsModal(){
document.getElementById('projectsModal').style.display='block';
loadProjects();
}

function loadProjects(){
const projects=JSON.parse(localStorage.getItem(STATE_KEYS.PROJECTS)||'[]');
const list=document.getElementById('projectList');
list.innerHTML=projects.length?'':'<p style="text-align:center;color:var(--secondary-text);padding:20px">No projects yet</p>';
projects.reverse().forEach((p,i)=>{
const div=document.createElement('div');
div.className='project-item';
div.innerHTML=`
<div class="project-name">${p.topic}</div>
<div class="project-preview">By ${p.author} â€¢ ${p.slides} slides</div>
<div class="project-stats">${new Date(p.date).toLocaleDateString()}</div>
<div class="project-actions">
<button onclick="loadProject(${projects.length-1-i})">Load</button>
<button onclick="deleteProject(${projects.length-1-i})">Delete</button>
</div>
`;
list.appendChild(div);
});
}

function loadProject(index){
const projects=JSON.parse(localStorage.getItem(STATE_KEYS.PROJECTS)||'[]');
const project=projects[index];
document.getElementById('xmlInput').value=project.xml;
localStorage.setItem(STATE_KEYS.XML_INPUT,project.xml);
document.getElementById('topicName').value=project.topic;
document.getElementById('authorName').value=project.author;
showCreateNew();
document.getElementById('templateSection').style.display='block';
closeModal('projectsModal');
}

function deleteProject(index){
if(!confirm('Delete this project?'))return;
const projects=JSON.parse(localStorage.getItem(STATE_KEYS.PROJECTS)||'[]');
projects.splice(index,1);
localStorage.setItem(STATE_KEYS.PROJECTS,JSON.stringify(projects));
loadProjects();
}

function startPresentation(){
const hasSeenInstructions=localStorage.getItem(STATE_KEYS.SEEN_INSTRUCTIONS);
document.getElementById('mainContent').style.display='none';
document.getElementById('mainHeader').style.display='none';
document.getElementById('presentationView').style.display='block';
const slidesContainer=document.getElementById('slidesContainer');
slidesContainer.innerHTML='';
slides.forEach((slideContent,index)=>{
const slideDiv=document.createElement('div');
slideDiv.className='slide';
slideDiv.innerHTML=slideContent;
if(index===currentSlide)slideDiv.classList.add('active');
slidesContainer.appendChild(slideDiv);
});
updateProgressBar();
setupSwipeGestures();
setupDoubleTap();
saveState(APP_STATES.PRESENTATION);
if(!hasSeenInstructions)document.getElementById('navInstructionsModal').style.display='block';
if(mode==='display'&&conn&&conn.open)sendRemoteData({type:'started',slides:slides.length});
}

function setupDoubleTap(){
const presentationView=document.getElementById('presentationView');
presentationView.addEventListener('touchend',(e)=>{
const currentTime=new Date().getTime();
const tapLength=currentTime-lastTap;
if(tapLength<300&&tapLength>0){
e.preventDefault();
toggleControls();
}
lastTap=currentTime;
});
presentationView.addEventListener('dblclick',(e)=>{
e.preventDefault();
toggleControls();
});
}

function toggleControls(){
const controls=document.getElementById('controls');
if(controls.classList.contains('visible')){
controls.classList.remove('visible');
}else{
controls.classList.add('visible');
setTimeout(()=>controls.classList.remove('visible'),3000);
}
}

function setupSwipeGestures(){
const presentationView=document.getElementById('presentationView');
presentationView.addEventListener('touchstart',(e)=>{
touchStartX=e.changedTouches[0].screenX;
},{passive:true});
presentationView.addEventListener('touchend',(e)=>{
touchEndX=e.changedTouches[0].screenX;
const diff=touchStartX-touchEndX;
if(Math.abs(diff)>50){
if(diff>0)nextSlide();
else previousSlide();
}
},{passive:true});
}

function previousSlide(){
if(currentSlide>0){
document.querySelectorAll('.slide')[currentSlide].classList.remove('active');
currentSlide--;
document.querySelectorAll('.slide')[currentSlide].classList.add('active');
updateProgressBar();
localStorage.setItem(STATE_KEYS.CURRENT_SLIDE,currentSlide.toString());
if(conn&&conn.open)sendRemoteData({type:'slideChange',slide:currentSlide});
}
}

function nextSlide(){
if(currentSlide<slides.length-1){
document.querySelectorAll('.slide')[currentSlide].classList.remove('active');
currentSlide++;
document.querySelectorAll('.slide')[currentSlide].classList.add('active');
updateProgressBar();
localStorage.setItem(STATE_KEYS.CURRENT_SLIDE,currentSlide.toString());
if(conn&&conn.open)sendRemoteData({type:'slideChange',slide:currentSlide});
}else{
document.getElementById('endOptions').style.display='block';
}
}

function updateProgressBar(){
const progress=((currentSlide+1)/slides.length)*100;
document.getElementById('progressBar').style.width=progress+'%';
}

function toggleFullscreen(){
if(!document.fullscreenElement)document.documentElement.requestFullscreen();
else if(document.exitFullscreen)document.exitFullscreen();
}

function exitPresentation(){
document.getElementById('presentationView').style.display='none';
document.getElementById('mainContent').style.display='block';
document.getElementById('mainHeader').style.display='block';
document.getElementById('heroSection').style.display='block';
document.getElementById('inputSection').style.display='none';
document.getElementById('endOptions').style.display='none';
saveState(APP_STATES.HOME);
if(document.fullscreenElement)document.exitFullscreen();
}

function restartPresentation(){
currentSlide=0;
document.querySelectorAll('.slide').forEach((slide,index)=>{
slide.classList.remove('active');
if(index===0)slide.classList.add('active');
});
updateProgressBar();
localStorage.setItem(STATE_KEYS.CURRENT_SLIDE,'0');
document.getElementById('endOptions').style.display='none';
}

function downloadPresentation(){
if(!presentationData){
alert('No presentation data available');
return;
}
const blob=new Blob([presentationData],{type:'application/xml'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;
const topic=localStorage.getItem(STATE_KEYS.TOPIC)||'presentation';
a.download=`${topic.replace(/[^a-z0-9]/gi,'_').toLowerCase()}_presentation.xml`;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);
}

function sharePresentation(){
const topic=localStorage.getItem(STATE_KEYS.TOPIC)||'';
const shareText=`ðŸŽ¯ Check out Prastuti - A Completely Free AI PPT Making Tool!

ðŸš€ Create professional presentations in minutes with AI assistance
âœ¨ No registration required, completely free
ðŸŽ¨ Beautiful themes and animations
ðŸ“± Works on all devices

Try it now: https://xchirxg.github.io/p/prastuti

${topic?`I just created an amazing presentation on "${topic}" using Prastuti!`:'Perfect for students, professionals, and educators!'}

#Prastuti #AI #Presentations #Free #Education`;
if(navigator.share){
navigator.share({
title:'Prastuti - Free AI PPT Making Tool',
text:shareText,
url:'https://xchirxg.github.io/p/prastuti'
}).catch(err=>{
navigator.clipboard.writeText(shareText).then(()=>{
alert('Prastuti link and promotion copied to clipboard! Share it with others! ðŸŽ‰');
});
});
}else{
navigator.clipboard.writeText(shareText).then(()=>{
alert('Prastuti link and promotion copied to clipboard! Share it with others! ðŸŽ‰');
}).catch(()=>{
prompt('Copy this text to share Prastuti:',shareText);
});
}
}

function createNewPresentation(){
document.getElementById('endOptions').style.display='none';
exitPresentation();
document.getElementById('topicName').value='';
document.getElementById('xmlInput').value='';
document.getElementById('templateSection').style.display='none';
saveState(APP_STATES.HOME);
}

function showRemoteSetup(){
document.getElementById('remoteSetupModal').style.display='block';
document.getElementById('remoteConnectSection').style.display='none';
document.getElementById('remoteStatus').innerText='Select your device role';
}

function showRemoteConnect(){
document.getElementById('remoteConnectSection').style.display='block';
document.getElementById('remoteStatus').innerText='Enter the code from Display';
document.getElementById('roomCodeInput').focus();
}

function startDisplay(){
mode='display';
myRoomCode=Math.floor(1000+Math.random()*9000).toString();
const fullId=ID_PREFIX+myRoomCode;
document.getElementById('remoteStatus').innerText='Starting Display...';
peer=new Peer(fullId);
peer.on('open',id=>{
document.getElementById('remoteStatus').innerText=`Display Code: ${myRoomCode}`;
console.log('Host ID:',id);
});
peer.on('connection',c=>{
if(conn)conn.close();
conn=c;
document.getElementById('remoteStatus').innerText='Remote Connected!';
conn.on('data',handleRemoteData);
conn.on('close',()=>{
document.getElementById('remoteStatus').innerText='Remote Disconnected';
conn=null;
});
setTimeout(()=>{
if(conn&&conn.open){
sendRemoteData({type:'syncAll',slides:slides.length,currentSlide:currentSlide,theme:document.body.classList.contains('dark-theme')?'dark':'light'});
}
},500);
});
peer.on('error',err=>{
if(err.type==='unavailable-id')startDisplay();
else alert("Network Error: "+err.type);
});
startHeartbeat();
saveState(APP_STATES.REMOTE_DISPLAY);
setTimeout(()=>closeModal('remoteSetupModal'),2000);
}

function connectToDisplay(){
const val=document.getElementById('roomCodeInput').value;
if(val.length<4){
document.getElementById('remoteStatus').innerText='Please enter 4-digit code';
document.getElementById('remoteStatus').className='status error';
return;
}
mode='controller';
document.getElementById('remoteStatus').innerText='Connecting...';
const targetId=ID_PREFIX+val;
peer=new Peer();
peer.on('open',()=>{
conn=peer.connect(targetId,{reliable:true});
setupConnectionHandlers();
});
peer.on('error',err=>{
document.getElementById('remoteStatus').innerText='Error: '+err.type;
document.getElementById('remoteStatus').className='status error';
if(err.type==='peer-unavailable')document.getElementById('remoteStatus').innerText='Display not found. Check code.';
});
}

function setupConnectionHandlers(){
conn.on('open',()=>{
console.log("Connected");
closeModal('remoteSetupModal');
document.getElementById('mainContent').style.display='none';
document.getElementById('mainHeader').style.display='none';
document.getElementById('controllerView').style.display='flex';
startHeartbeat();
saveState(APP_STATES.REMOTE_CONTROLLER);
});
conn.on('data',data=>{
if(data.type==='syncAll'){
console.log('Synced with display');
}
});
conn.on('close',()=>{
console.log("Connection lost");
setTimeout(()=>{
if(peer&&!peer.destroyed){
conn=peer.connect(conn.peer);
setupConnectionHandlers();
}
},2000);
});
conn.on('error',err=>console.error(err));
}

function startHeartbeat(){
if(heartbeatInterval)clearInterval(heartbeatInterval);
heartbeatInterval=setInterval(()=>{
if(conn&&conn.open)sendRemoteData({type:'ping'});
},2000);
}

function sendRemoteData(data){
if(conn&&conn.open)conn.send(data);
}

function handleRemoteData(data){
switch(data.type){
case 'prev':
previousSlide();
break;
case 'next':
nextSlide();
break;
case 'reset':
restartPresentation();
break;
case 'fullscreen':
toggleFullscreen();
break;
case 'theme':
toggleTheme();
break;
case 'fontSize':
const allSlides=document.querySelectorAll('.slide');
allSlides.forEach(slide=>{
slide.style.fontSize=data.value+'px';
});
break;
case 'exit':
exitPresentation();
break;
case 'ping':
break;
}
}

function remoteAction(action){
if(action==='prev'||action==='next'||action==='reset'||action==='fullscreen'||action==='theme'||action==='exit'){
sendRemoteData({type:action});
}
}

function updateRemoteFontSize(value){
document.getElementById('fontSizeValue').innerText=value+'px';
sendRemoteData({type:'fontSize',value:parseInt(value)});
}

function disconnectRemote(){
if(conn)conn.close();
if(peer)peer.destroy();
document.getElementById('controllerView').style.display='none';
document.getElementById('mainContent').style.display='block';
document.getElementById('mainHeader').style.display='block';
document.getElementById('heroSection').style.display='block';
saveState(APP_STATES.HOME);
}

document.addEventListener('keydown',(e)=>{
if(document.getElementById('presentationView').style.display==='block'){
switch(e.key){
case 'ArrowRight':
case ' ':
e.preventDefault();
nextSlide();
break;
case 'ArrowLeft':
e.preventDefault();
previousSlide();
break;
case 'F11':
e.preventDefault();
toggleFullscreen();
break;
case 'Escape':
if(document.fullscreenElement){
document.exitFullscreen();
}else if(document.getElementById('endOptions').style.display==='block'){
document.getElementById('endOptions').style.display='none';
}else{
exitPresentation();
}
break;
}
}
});

document.addEventListener('DOMContentLoaded',()=>{
loadTheme();
loadState();
});
</script>
</body>
</html>

